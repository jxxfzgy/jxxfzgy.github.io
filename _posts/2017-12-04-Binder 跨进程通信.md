---
layout: post
title: Binder 跨进程通信
key: 20171204
tags: Binder IPC Android
---

### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i>  Binder IPC 原理
##### <i class="fa fa-star" aria-hidden="true"></i> IPC 概念
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
IPC(Inter-Process Communication)，意为进程间通信，通常是指两个进程之间进行数据交换的过程；Android 不同应用在没有设置 shareUid 的情况下，运行在不同的进程之间，不同应用之间需要进行数据交换的过程属于 IPC 的一种。
##### <i class="fa fa-star" aria-hidden="true"></i> 其他 IPC
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
除了 Binder ，Linux 下还有以下几种 IPC

+ 共享内存
+ 套接字
+ 匿名管道
+ 命名管道
+ 消息队里
+ 信号量
+ 信号

有兴趣的同学可以去了解下以上 IPC 的原理。

##### <i class="fa fa-star" aria-hidden="true"></i> Binder IPC
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
IPC 原理图

![](/assets/binder/kernel.png)

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
每个进程都分为用户空间和内核空间，用户空间的数据是不能跟共享的，而内核空间却是可以共享的，客户端进程把需要交换的数据写入内核层，服务端进程再从内核中获取数据以此实现跨进程通信；Binder IPC 是通过 Binder 驱动来实现的，Binder 驱动与其他字符驱动原理一样，在系统启动的时候，会在 dev 目录下创建 binder 驱动，不同的进程通过访问和操作 binder 驱动实现用户空间和内核空间数据交互。
### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i>  Binder 架构
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Binder 采用 C/S 架构，C 代表客户端进程，S 代表服务端进程，客户端和服务端建立连接需要用到 Binder 的守护进程 ServiceManager 进程，ServiceManager 作为所有 Binder 服务的大管家，所有服务(<font color="red">匿名 binder 除外</font>)都需要向ServiceManager大管家注册,客户端进程通过服务大管家的 getService("服务名称") 获取服务，至此客户端持有服务端的 binder 引用，从而能间接实现数据交互，架构图如下：

![](/assets/binder/service.png)

### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i> Binder 实现细节
##### <i class="fa fa-star" aria-hidden="true"></i> Binder 驱动
##### <i class="fa fa-star" aria-hidden="true"></i> Binder 守护进程
##### <i class="fa fa-star" aria-hidden="true"></i> 注册 Binder 服务
##### <i class="fa fa-star" aria-hidden="true"></i> 获取 Binder 服务
### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i> 匿名 Binder
##### <i class="fa fa-star" aria-hidden="true"></i> 什么是匿名 Binder
### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i> 总结

