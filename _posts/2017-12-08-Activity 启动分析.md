---
layout: post
title: Activity 启动分析
key: 20171208
tags: Acvitity Android
---

### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i>  概述
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Acvitity 作为 Android 四大组件中使用频率最高的组件，作为 Android 开发者，对于 Activity 的启动一点都不陌生，包括他的启动方式，启动模式，因为这都可能在开发过程中用到，但是启动的内部流程我们却往往并不关心，系统已封装好，作为一名合格的程序猿，系统服务也是该掌握的。
##### <i class="fa fa-star" aria-hidden="true"></i> Activity 启动方式
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
从大方向来分，Activity 的启动分为显示启动和隐式启动两种启动方式<br>
1.显示启动：<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据类名启动
```java
Intent it = new Intent(A.this,B.class);
startActivity(it);
```
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据包名启动
```java
Intent it = new Intent(A.this,B.class);
it.setComponent(new ComponentName("package","class"));
startActivity(it);
```
2.显示启动：<br>
```java
Intent it = new Intent("action");
startActivity(it);
```
无论哪种启动方式，最终都会进入startActivity()方法。
##### <i class="fa fa-star" aria-hidden="true"></i> 启动流程图解
[查看大图](www)

![](/assets/activitystart/startActivity.png)

其中：
 + AMProxy:ActivityManagerProxy
 + AMNative:ActivityManagerNative
 + AMS:ActivityManagerService
 + AS:ActivityStarter
 + ASS:ActivityStackSupervisor
 + AStack:ActivityStack

### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i> 代码跟踪
1、Activity 中的 startActivity

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
该方法最终会进入startActivityForResult，Activity 中的 parent 始终为空
```java
    public void startActivityForResult(@RequiresPermission Intent intent, int requestCode,
            @Nullable Bundle options) {
        //进入该分支
        if (mParent == null) {
            Instrumentation.ActivityResult ar =
                mInstrumentation.execStartActivity(
                    this, mMainThread.getApplicationThread(), mToken, this,
                    intent, requestCode, options);
            if (ar != null) {
                mMainThread.sendActivityResult(
                    mToken, mEmbeddedID, requestCode, ar.getResultCode(),
                    ar.getResultData());
            }
            cancelInputsAndStartExitTransition(options);
        }
    }
```
2、Instrumentation 中的 execStartActivity

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
### <i class="fa fa-rebel fa-1x" aria-hidden="true"></i> 总结

